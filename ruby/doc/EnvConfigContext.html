<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: EnvConfigContext
  
    &mdash; Documentation by YARD 0.9.24
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "EnvConfigContext";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (E)</a> &raquo;
    
    
    <span class="title">EnvConfigContext</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: EnvConfigContext
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">EnvConfigContext</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>src/config_context_handler.rb</dd>
  </dl>
  
</div>








  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#__normalize-instance_method" title="#__normalize (instance method)">#<strong>__normalize</strong>(returned_json)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#__process_context-instance_method" title="#__process_context (instance method)">#<strong>__process_context</strong>(json_data, context_data)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add-instance_method" title="#add (instance method)">#<strong>add</strong>(key, value)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(env)  &#x21d2; EnvConfigContext </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of EnvConfigContext.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process-instance_method" title="#process (instance method)">#<strong>process</strong>(config_json)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(env)  &#x21d2; <tt><span class='object_link'><a href="" title="EnvConfigContext (class)">EnvConfigContext</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of EnvConfigContext.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'src/config_context_handler.rb', line 43</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>
  <span class='ivar'>@__env</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>
  <span class='ivar'>@__app_context_data</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='comment'># Adding &quot;TWIST_ENV&quot; as context variable referencing the contextual env (&quot;production&quot;, &quot;staging&quot;, &quot;dev&quot;, &quot;qa&quot;)
</span>  <span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="top-level-namespace.html#ENV_VAR_NAME-constant" title="ENV_VAR_NAME (constant)">ENV_VAR_NAME</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>

  <span class='comment'># Adding &quot;ENV_NAME&quot; as context variable referencing the actual env name (prefix &quot;dynamic-&quot; excluded)
</span>  <span class='id identifier rubyid_env_name_without_dynamic_part'>env_name_without_dynamic_part</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^dynamic-</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ENV_NAME</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_env_name_without_dynamic_part'>env_name_without_dynamic_part</span><span class='rparen'>)</span>

  <span class='comment'># Adding &quot;ENV_NAME_FOR_DOMAIN&quot; as context variable referencing the env name (prefix &quot;dynamic-&quot; excluded)
</span>  <span class='comment'># to be used when referencing ingress like mailer-my-dyna-env.twistbioscience-dev.com
</span>  <span class='id identifier rubyid_env_name_for_domain'>env_name_for_domain</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env_name_without_dynamic_part'>env_name_without_dynamic_part</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="top-level-namespace.html#FIXED_ENVS-constant" title="FIXED_ENVS (constant)">FIXED_ENVS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_env_name_for_domain'>env_name_for_domain</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ENV_NAME_FOR_DOMAIN</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_env_name_for_domain'>env_name_for_domain</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="__normalize-instance_method">
  
    #<strong>__normalize</strong>(returned_json)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


79
80
81
82
83
84
85
86
87
88
89
90
91</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'src/config_context_handler.rb', line 79</span>

<span class='kw'>def</span> <span class='id identifier rubyid___normalize'>__normalize</span><span class='lparen'>(</span><span class='id identifier rubyid_returned_json'>returned_json</span><span class='rparen'>)</span>
  <span class='comment'># deleting the context declaration from the to-be-consumed config
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_returned_json'>returned_json</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="top-level-namespace.html#CONTEXT_DECLARATION_KEY-constant" title="CONTEXT_DECLARATION_KEY (constant)">CONTEXT_DECLARATION_KEY</a></span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_returned_json'>returned_json</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="top-level-namespace.html#CONTEXT_DECLARATION_KEY-constant" title="CONTEXT_DECLARATION_KEY (constant)">CONTEXT_DECLARATION_KEY</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
    <span class='id identifier rubyid_returned_json'>returned_json</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="top-level-namespace.html#CONTEXT_DECLARATION_KEY-constant" title="CONTEXT_DECLARATION_KEY (constant)">CONTEXT_DECLARATION_KEY</a></span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># ensuring no value is left with templated place holder (ie &#39; {{ key }} &#39;)
</span>  <span class='comment'># the below will raise an exception
</span>  <span class='id identifier rubyid_validate_no_template_left'><span class='object_link'><a href="top-level-namespace.html#validate_no_template_left-instance_method" title="#validate_no_template_left (method)">validate_no_template_left</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_returned_json'>returned_json</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_returned_json'>returned_json</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="__process_context-instance_method">
  
    #<strong>__process_context</strong>(json_data, context_data)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'src/config_context_handler.rb', line 93</span>

<span class='kw'>def</span> <span class='id identifier rubyid___process_context'>__process_context</span><span class='lparen'>(</span><span class='id identifier rubyid_json_data'>json_data</span><span class='comma'>,</span> <span class='id identifier rubyid_context_data'>context_data</span><span class='rparen'>)</span>
  <span class='comment'># traverse the json to look for {{ token }} templates to substitute with value from context
</span>  <span class='id identifier rubyid_json_data'>json_data</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_json_data'>json_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid___process_context'>__process_context</span><span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_context_data'>context_data</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
      <span class='comment'># attempt extracting the templated token from the provided string
</span>      <span class='id identifier rubyid_match'>match</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="top-level-namespace.html#TEMPLATE_REGEX-constant" title="TEMPLATE_REGEX (constant)">TEMPLATE_REGEX</a></span></span><span class='rparen'>)</span>

      <span class='kw'>while</span> <span class='id identifier rubyid_match'>match</span>
        <span class='comment'># the template token lays inside the match.
</span>        <span class='comment'># this is sensitive assumption but it is protected by unit tests! (the regex)
</span>        <span class='id identifier rubyid_keyword'>keyword</span> <span class='op'>=</span> <span class='id identifier rubyid_match'>match</span><span class='period'>.</span><span class='id identifier rubyid_captures'>captures</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>

        <span class='comment'># skip token if context data does not provide value (it will fail later in normalization)
</span>        <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_context_data'>context_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_keyword'>keyword</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

        <span class='comment'># for non str value the config data s replaced as is with the provided context data (even if its dict!)
</span>        <span class='comment'># otherwise (string) is replaced &quot;123{{ token  }}789&quot; =&gt; &quot;123456789&quot; given context_data[&quot;token&quot;] = &quot;456&quot;
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_context_data'>context_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_keyword'>keyword</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_the_val'>the_val</span> <span class='op'>=</span> <span class='id identifier rubyid_context_data'>context_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_keyword'>keyword</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_template'>template</span> <span class='op'>=</span> <span class='id identifier rubyid_match'>match</span><span class='period'>.</span><span class='id identifier rubyid_captures'>captures</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
          <span class='id identifier rubyid_with_template'>with_template</span> <span class='op'>=</span> <span class='id identifier rubyid_json_data'>json_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_json_data'>json_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_json_data'>json_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='id identifier rubyid_template'>template</span><span class='comma'>,</span> <span class='id identifier rubyid_the_val'>the_val</span><span class='rparen'>)</span>
          <span class='comment'># trying to find a next token if exists (ex. &quot;Hello {{ FIRST_NAME }} {{ LAST_NAME }}&quot;)
</span>          <span class='id identifier rubyid_match'>match</span> <span class='op'>=</span> <span class='id identifier rubyid_json_data'>json_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="top-level-namespace.html#TEMPLATE_REGEX-constant" title="TEMPLATE_REGEX (constant)">TEMPLATE_REGEX</a></span></span><span class='rparen'>)</span>
          <span class='comment'># want to print once per cycle
</span>          <span class='const'><span class='object_link'><a href="Log.html" title="Log (class)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debug'><span class='object_link'><a href="Log.html#debug-class_method" title="Log.debug (method)">debug</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>replacing config key </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='embexpr_end'>}</span><span class='tstring_content'> value from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_with_template'>with_template</span><span class='embexpr_end'>}</span><span class='tstring_content'> to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_json_data'>json_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_match'>match</span>
        <span class='kw'>else</span>
          <span class='const'><span class='object_link'><a href="Log.html" title="Log (class)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debug'><span class='object_link'><a href="Log.html#debug-class_method" title="Log.debug (method)">debug</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>replacing config key </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='embexpr_end'>}</span><span class='tstring_content'> value from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_json_data'>json_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_context_data'>context_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_keyword'>keyword</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid_json_data'>json_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_context_data'>context_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_keyword'>keyword</span><span class='rbracket'>]</span>
          <span class='comment'># assuming no composite var/token in a non str value
</span>          <span class='kw'>break</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_json_data'>json_data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="add-instance_method">
  
    #<strong>add</strong>(key, value)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


64
65
66
67
68
69
70
71
72
73
74
75
76
77</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'src/config_context_handler.rb', line 64</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@__app_context_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span>
    <span class='const'><span class='object_link'><a href="Log.html" title="Log (class)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debug'><span class='object_link'><a href="Log.html#debug-class_method" title="Log.debug (method)">debug</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Context data [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'>] is being overriden from </span><span class='embexpr_beg'>#{</span><span class='ivar'>@__app_context_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># the interpretation of production vs staging is done here.
</span>  <span class='comment'># all ENV names that are not PRODUCTION_BRANCH_NAME are regarded as staging
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="top-level-namespace.html#ENV_VAR_NAME-constant" title="ENV_VAR_NAME (constant)">ENV_VAR_NAME</a></span></span>
    <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_get_contextual_env'><span class='object_link'><a href="top-level-namespace.html#get_contextual_env-instance_method" title="#get_contextual_env (method)">get_contextual_env</a></span></span>
  <span class='kw'>end</span>

  <span class='const'><span class='object_link'><a href="Log.html" title="Log (class)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debug'><span class='object_link'><a href="Log.html#debug-class_method" title="Log.debug (method)">debug</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Adding context: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'> =&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@__app_context_data</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process-instance_method">
  
    #<strong>process</strong>(config_json)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'src/config_context_handler.rb', line 133</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process'>process</span><span class='lparen'>(</span><span class='id identifier rubyid_config_json'>config_json</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_config_json'>config_json</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_config_json'>config_json</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_config_json'>config_json</span>
  <span class='kw'>end</span>

  <span class='comment'># ensuring manipulation of copied version, never original
</span>  <span class='id identifier rubyid_json_copy'>json_copy</span> <span class='op'>=</span> <span class='const'>Marshal</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='const'>Marshal</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span><span class='lparen'>(</span><span class='id identifier rubyid_config_json'>config_json</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_current_context'>current_context</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='comment'># per context for:
</span>  <span class='comment'># env_name: { .. } AND/OR
</span>  <span class='comment'># somthing: { ... }
</span>  <span class='comment'>#
</span>  <span class='comment'># look for the context key in data (which is affected by TWIST_ENV but any app provided context keys when
</span>  <span class='comment'># calling to add method above) - when found - this is the context vlaues to use when parsing the rest
</span>  <span class='comment'># of the json
</span>  <span class='id identifier rubyid_context_decleration'>context_decleration</span> <span class='op'>=</span> <span class='id identifier rubyid_json_copy'>json_copy</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="top-level-namespace.html#CONTEXT_DECLARATION_KEY-constant" title="CONTEXT_DECLARATION_KEY (constant)">CONTEXT_DECLARATION_KEY</a></span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_context_decleration'>context_decleration</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_context_decl_key'>context_decl_key</span><span class='comma'>,</span> <span class='id identifier rubyid_context_data'>context_data</span><span class='op'>|</span>
    <span class='comment'># rubocop:disable Lint/UnusedBlockArgument
</span>    <span class='ivar'>@__app_context_data</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_context_data_key'>context_data_key</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
      <span class='comment'># puts &quot;\n ===&gt; context_decl_key: #{context_decl_key} context_data: &quot; \
</span>      <span class='comment'># &quot;#{context_data} context_data_key: #{context_data_key} v: #{v}&quot;
</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_context_decl_key'>context_decl_key</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>==</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>
        <span class='comment'># merge (spread) context_data into current_context
</span>        <span class='id identifier rubyid_context_data'>context_data</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ck'>ck</span><span class='comma'>,</span> <span class='id identifier rubyid_cv'>cv</span><span class='op'>|</span>
          <span class='id identifier rubyid_current_context'>current_context</span><span class='lbracket'>[</span><span class='id identifier rubyid_ck'>ck</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_cv'>cv</span>
        <span class='kw'>end</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='comment'># rubocop:enable Lint/UnusedBlockArgument
</span>  <span class='kw'>end</span>

  <span class='comment'># merging app data context into context found in config json context
</span>  <span class='ivar'>@__app_context_data</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_app_context_key'>app_context_key</span><span class='comma'>,</span> <span class='id identifier rubyid_context_data'>context_data</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_current_context'>current_context</span><span class='lbracket'>[</span><span class='id identifier rubyid_app_context_key'>app_context_key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_app_context_key'>app_context_key</span><span class='embexpr_end'>}</span><span class='tstring_content'> is already defined by config $context, use another key name</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_current_context'>current_context</span><span class='lbracket'>[</span><span class='id identifier rubyid_app_context_key'>app_context_key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_context_data'>context_data</span>
  <span class='kw'>end</span>

  <span class='const'><span class='object_link'><a href="Log.html" title="Log (class)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debug'><span class='object_link'><a href="Log.html#debug-class_method" title="Log.debug (method)">debug</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>detected config context to use: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_current_context'>current_context</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='comment'># replace the templated valued from chosen context
</span>  <span class='id identifier rubyid_processed_json'>processed_json</span> <span class='op'>=</span> <span class='id identifier rubyid___process_context'>__process_context</span><span class='lparen'>(</span><span class='id identifier rubyid_json_copy'>json_copy</span><span class='comma'>,</span> <span class='id identifier rubyid_current_context'>current_context</span><span class='rparen'>)</span>

  <span class='id identifier rubyid___normalize'>__normalize</span><span class='lparen'>(</span><span class='id identifier rubyid_processed_json'>processed_json</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Apr 26 09:15:49 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.24 (ruby-2.6.3).
</div>

    </div>
  </body>
</html>